# Kobo

## Finding the database!

On my Kobo Libra 2 and Kobo Clara 2E there is a `.kobo` directory with a `KoboReader.sqlite` file inside. I've been able to open this with `sqlite3` command and dump the contents.

## Reading the database

### Event table

The Event table looks like a good start. But it contains a BLOB and I found this thread https://www.mobileread.com/forums/showthread.php?t=313990 discussing reading it.

```sql
CREATE TABLE Event (
	EventType INTEGER NOT NULL,
	FirstOccurrence TEXT, LastOccurrence TEXT,
	EventCount INTEGER DEFAULT 0,
	ContentID TEXT,
	ExtraData BLOB, Checksum TEXT,
	PRIMARY KEY (EventType, ContentID) );
```

EventType guesses
- 46 : Reading session? The ExtraData contains data like this: {"ContentType":"YXBwbGljYXRpb24veC1rb2JvLWh0bWwrcG9ja2V0","ExtraDataDateCreated":"2023-01-07T22:00:13Z","ExtraDataReadingSeconds":81,"ExtraDataReadingSessions":1,"PagesTurnedThisSession":0,"ViewType":"ReadingView"}. Not sure why the ContentType is base64 encoded? Decoded this one is: "application/x-kobo-html+pocket" I guess string is bytes and bytes is shown as base64 by the json encoder I used to read this.
- 3 same as above?
- 1020 & 1021 : Reading start. Reading end. The ExtraData contains like {"eventTimestamps":[1673504758,1673504766]} and these lists can be 1 or many
- 9 : Dictionary lookup ExtraData {"DictionaryName":"-en","Word":"prodigal","eventTimestamps":[1673648750,1673648754,1674138378,1674165824]}
- 8 : not sure
- 1012, 1013, 1014 : not sure looks like progress 25,50,75 ?
- 80 : Book finished ?
- 5 same as above?

Given the duplicates 3 / 46 above may need to handle both and find some way to remove duplicates. I guess some devices may store only 3 or 46 not both?

Some Sample Data

```
---------------------------------
46 / 2023-01-20T00:11:22.000 / 2023-01-20T00:11:22.000
308 / file:///mnt/onboard/Pullman, Philip/His Dark Materials_ Northern Lights - Philip Pullman.kepub.epub / len(colData)=6038
{"ContentType":"YXBwbGljYXRpb24veC1rb2JvLWVwdWIremlw","ExtraDataDateCreated":"2023-01-12T06:29:27Z","ExtraDataReadingSeconds":27106,"ExtraDataReadingSessions":49,"PagesTurnedThisSession":0,"ViewType":"ReadingView","eventTimestamps":[1673504979,1673520039,1673520116,1673560744,1673560840,1673562045,1673562130,16
73562385,1673562500,1673601199,1673601269,1673639194,1673639217,1673639277,1673639365,1673639441,1673648193,1673648305,1673648397,1673648478,1673648603,1673648717,1673648758,1673648764,1673648852,1673648931,1673648999,1673649062,1673649126,1673649166,1673691611,1673691650,1673691756,1673696800,1673703427,167370
3492,1673703584,1673703656,1673703762,1673703839,1673703917,1673706432,1673707115,1673731183,1673731264,1673731358,1673731440,1673731508,1673731569,1673731627,1673731707,1673731799,1673731876,1673731951,1673732033,1673732094,1673732180,1673732247,1673733441,1673734644,1673734711,1673734770,1673734855,1673734952,1673735057,1673735121,1673735527,1673735615,1673735716,1673735785,1673735840,1673735902,1673735987,1673736119,1673736200,1673736307,1673736406,1673736496,1673736554,1673736644,1673736778,1673736886,1673736965,1673737051,1673737132,1673737231,1673737347,1673737706,1673737737,1673737839,1673737954,1673738042,1673738136,1673738142,1673888938,1673889043,1673902895,1673902953,1673903034,1673903088,1673903201,1673903304,1673903363,1673903480,1673903555,1673903671,1673903745,1673903796,1673903838,1673903888,1673903959,1673903986,1673904051,1673904114,1673904169,1673904258,1673904354,1673904577,1673904652,1673904712,1673904762,1673904845,1673904896,1673904977,1673905060,1673905132,1673905208,1673905420,1673905526,1673905589,1673905659,1673905738,1673905792,1673905851,1673905921,1673905988,1673936387,1673936643,1673936759,1673936839,1673936898,1673937005,1673937673,1673937715,1673937899,1673937971,1673938168,1673938255,1673938351,1673938399,1673938457,1673942727,1673942777,1673942826,1673942840,1673942898,1673942952,1673942993,1673943054,1673943120,1673953186,1673986090,1673986178,1673986256,1673986331,1673986389,1673986468,1673986536,1673986589,1673991916,1673992001,1673993246,1673993344,1673993425,1673993645,1673993749,1673993820,1673993937,1673994016,1673994097,1673994199,1673994288,1673994329,1673994391,1673994442,1673994445,1674026864,1674026953,1674027098,1674068370,1674068624,1674069712,1674079511,1674079596,1674079665,1674080549,1674080680,1674080765,1674080854,1674080947,1674081047,1674081128,1674081232,1674081327,1674081421,1674081519,1674081608,1674081663,1674110718,1674110812,1674110916,1674110982,1674117799,1674117904,1674135614,1674135663,1674135843,1674135910,1674135992,1674136094,1674136242,1674136330,1674136437,1674136501,1674136567,1674136637,1674136750,1674136819,1674136885,1674136950,1674136999,1674137017,1674137059,1674137233,1674137307,1674137445,1674137497,1674137569,1674137636,1674137761,1674138194,1674138229,1674138252,1674138295,1674138341,1674138419,1674138479,1674138556,1674138559,1674164680,1674164991,1674165077,1674165163,1674165317,1674165388,1674165403,1674165517,1674165621,1674165758,1674165868,1674165915,1674165971,1674166136,1674166220,1674166285,1674166341,1674166406,1674166525,1674166609,1674166664,1674166741,1674166742,1674166745,1674166747,1674166749,1674166750,1674166750,1674166751,1674166758,1674166850,1674167002,1674167088,1674167171,1674167254,1674167259,1674167325,1674167523,1674167597,1674167598,1674167676,1674167752,1674167902,1674167985,1674168102,1674168437,1674168513,1674168599,1674168672,1674168740,1674168805,1674168851,1674171650,1674171813,1674172067,1674172157,1674172248,1674172315,1674172326],"wordCounts":[254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,244,244,244,244,244,244,244,244,244,244,244,244,244,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,3,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,251,251,251,251,251,251,251,251,251,251,251,251,228,228,228,228,228,228,228,228],"wordsRead":228

# Duplicate of above with different event type ??
3 /  / 2023-01-20T00:11:23.000
51 / file:///mnt/onboard/Pullman, Philip/His Dark Materials_ Northern Lights - Philip Pullman.kepub.epub / len(colData)=6047
{"ContentType":"YXBwbGljYXRpb24veC1rb2JvLWVwdWIremlw","ExtraDataDateCreated":"2023-01-12T06:29:27Z","ExtraDataReadingSeconds":27106,"ExtraDataReadingSessions":49,"PagesTurnedThisSession":0,"ViewType":"ReadingView","eventTimestamps":[1673504979,1673520039,1673520116,1673560744,1673560840,1673562045,1673562130,1673562385,1673562500,1673601199,1673601269,1673639194,1673639217,1673639277,1673639365,1673639441,1673648193,1673648305,1673648397,1673648478,1673648603,1673648717,1673648758,1673648764,1673648852,1673648931,1673648999,1673649062,1673649126,1673649166,1673691611,1673691650,1673691756,1673696800,1673703427,1673703492,1673703584,1673703656,1673703762,1673703839,1673703917,1673706432,1673707115,1673731183,1673731264,1673731358,1673731440,1673731508,1673731569,1673731627,1673731707,1673731799,1673731876,1673731951,1673732033,1673732094,1673732180,1673732247,1673733441,1673734644,1673734711,1673734770,1673734855,1673734952,1673735057,1673735121,1673735527,1673735615,1673735716,1673735785,1673735840,1673735902,1673735987,1673736119,1673736200,1673736307,1673736406,1673736496,1673736554,1673736644,1673736778,1673736886,1673736965,1673737051,1673737132,1673737231,1673737347,1673737706,1673737737,1673737839,1673737954,1673738042,1673738136,1673738142,1673888938,1673889043,1673902895,1673902953,1673903034,1673903088,1673903201,1673903304,1673903363,1673903480,1673903555,1673903671,1673903745,1673903796,1673903838,1673903888,1673903959,1673903986,1673904051,1673904114,1673904169,1673904258,1673904354,1673904577,1673904652,1673904712,1673904762,1673904845,1673904896,1673904977,1673905060,1673905132,1673905208,1673905420,1673905526,1673905589,1673905659,1673905738,1673905792,1673905851,1673905921,1673905988,1673936387,1673936643,1673936759,1673936839,1673936898,1673937005,1673937673,1673937715,1673937899,1673937971,1673938168,1673938255,1673938351,1673938399,1673938457,1673942727,1673942777,1673942826,1673942840,1673942898,1673942952,1673942993,1673943054,1673943120,1673953186,1673986090,1673986178,1673986256,1673986331,1673986389,1673986468,1673986536,1673986589,1673991916,1673992001,1673993246,1673993344,1673993425,1673993645,1673993749,1673993820,1673993937,1673994016,1673994097,1673994199,1673994288,1673994329,1673994391,1673994442,1673994445,1674026864,1674026953,1674027098,1674068370,1674068624,1674069712,1674079511,1674079596,1674079665,1674080549,1674080680,1674080765,1674080854,1674080947,1674081047,1674081128,1674081232,1674081327,1674081421,1674081519,1674081608,1674081663,1674110718,1674110812,1674110916,1674110982,1674117799,1674117904,1674135614,1674135663,1674135843,1674135910,1674135992,1674136094,1674136242,1674136330,1674136437,1674136501,1674136567,1674136637,1674136750,1674136819,1674136885,1674136950,1674136999,1674137017,1674137059,1674137233,1674137307,1674137445,1674137497,1674137569,1674137636,1674137761,1674138194,1674138229,1674138252,1674138295,1674138341,1674138419,1674138479,1674138556,1674138559,1674164680,1674164991,1674165077,1674165163,1674165317,1674165388,1674165403,1674165517,1674165621,1674165758,1674165868,1674165915,1674165971,1674166136,1674166220,1674166285,1674166341,1674166406,1674166525,1674166609,1674166664,1674166741,1674166742,1674166745,1674166747,1674166749,1674166750,1674166750,1674166751,1674166758,1674166850,1674167002,1674167088,1674167171,1674167254,1674167259,1674167325,1674167523,1674167597,1674167598,1674167676,1674167752,1674167902,1674167985,1674168102,1674168437,1674168513,1674168599,1674168672,1674168740,1674168805,1674168851,1674171650,1674171813,1674172067,1674172157,1674172248,1674172315,1674172326,1674173483],"wordCounts":[254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,244,244,244,244,244,244,244,244,244,244,244,244,244,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,3,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,265,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,251,251,251,251,251,251,251,251,251,251,251,251,228,228,228,228,228,228,228,228],"wordsRead":228}

---------------------------------
9 /  / 2023-01-19T22:03:44.000
4 / file:///mnt/onboard/Pullman, Philip/His Dark Materials_ Northern Lights - Philip Pullman.kepub.epub / len(colData)=167
{"DictionaryName":"-en","Word":"prodigal","eventTimestamps":[1673648750,1673648754,1674138378,1674165824]}

---------------------------------
1020 /  / 2023-01-20T00:11:23.000
51 / file:///mnt/onboard/Pullman, Philip/His Dark Materials_ Northern Lights - Philip Pullman.kepub.epub / len(colData)=506
{"eventTimestamps":[1673504967,1673504975,1673505383,1673519973,1673560647,1673561892,1673601162,1673639193,1673647118,1673647969,1673648078,1673691591,1673696698,1673703356,1673706128,1673706411,1673707045,1673730938,1673733400,1673734433,1673737704,1673855145,1673855267,1673861452,1673888881,1673902746,1673904205,1673936339,1673937571,1673942634,1673953096,1673985999,1673991815,1673993128,1674026827,1674068175,1674069604,1674069784,1674079453,1674080441,1674110671,1674117760,1674117991,1674134423,1674135592,1674138132,1674164544,1674168353,1674171574,1674172011,1674173483]}
---------------------------------
1021 /  / 2023-01-20T00:22:16.000
51 / file:///mnt/onboard/Pullman, Philip/His Dark Materials_ Northern Lights - Philip Pullman.kepub.epub / len(colData)=506
{"eventTimestamps":[1673504970,1673504982,1673505384,1673520151,1673560868,1673562641,1673601295,1673639510,1673647123,1673647974,1673649200,1673691761,1673696809,1673703926,1673706230,1673706484,1673707140,1673732252,1673733451,1673737455,1673738157,1673855146,1673855268,1673861456,1673889163,1673904173,1673906004,1673937119,1673938487,1673943123,1673953220,1673986603,1673992018,1673994451,1674027103,1674068682,1674069750,1674069829,1674079708,1674081692,1674111006,1674117946,1674117993,1674134424,1674137779,1674138569,1674168117,1674168856,1674172005,1674172330,1674174136]}

---------------------------------
1020 /  / 2023-12-14T22:24:56.000
123 / file:///mnt/onboard/King, Stephen/Different Seasons - Stephen King.kepub.epub / len(colData)=1154
{"eventTimestamps":[1693930890,1693930899,1693936983,1693937660,1693938179,1693944813,1693948634,1693976075,1693978468,1693987803,1694017253,1694023643,1694025132,1694028748,1694034129,1694075828,1694078064,1694103521,1694109120,1694111738,1694115739,1694120970,1694157673,1694183825,1694184422,1694187669,1694190065,1694201390,1695932542,1695932749,1695934209,1695974334,1696001392,1696002718,1696003537,1696012056,1696156486,1696157309,1696157326,1696192737,1696193984,1696224515,1696247102,1696271024,1696277584,1696278940,1696312095,1696347739,1696366153,1696366200,1696367573,1696442545,1696442915,1696452370,1696537045,1696538806,1696540158,1696566979,1696603974,1696608545,1696615593,1696625317,1696626886,1696700864,1696711243,1696712374,1696768888,1696786127,1699306101,1699306649,1699306839,1699308829,1699310229,1699345232,1699358720,1699386602,1699390925,1699391624,1699476729,1699477573,1699481503,1699566923,1699568986,1699602857,1699633690,1699633700,1699648301,1702073314,1702074860,1702075485,1702104138,1702147080,1702150160,1702155376,1702157248,1702158610,1702242029,1702243273,1702244675,1702246369,1702283012,1702301271,1702308707,1702322791,1702329571,1702332910,1702370146,1702395784,1702398130,1702413877,1702415893,1702417151,1702419031,1702454160,1702499607,1702501536,1702504602,1702506347,1702542480,1702567491,1702586616,1702590986,1702592696]}
---------------------------------
1021 /  / 2023-12-14T22:32:11.000
123 / file:///mnt/onboard/King, Stephen/Different Seasons - Stephen King.kepub.epub / len(colData)=1154
{"eventTimestamps":[1693930893,1693931431,1693937095,1693937891,1693938686,1693947573,1693949799,1693977720,1693978692,1693988046,1694017910,1694024248,1694025334,1694029408,1694035211,1694076008,1694078065,1694103755,1694109545,1694112109,1694118527,1694122266,1694157976,1694184168,1694186203,1694188878,1694190481,1694204351,1695932589,1695932888,1695934926,1695974548,1696001547,1696003110,1696003640,1696012064,1696156515,1696157312,1696157985,1696192955,1696195317,1696224731,1696247211,1696271027,1696277783,1696279448,1696312382,1696347923,1696366156,1696366348,1696369018,1696442841,1696442994,1696454192,1696537326,1696539529,1696540399,1696568115,1696604142,1696608547,1696615749,1696625676,1696628636,1696701536,1696711369,1696713234,1696769152,1696786130,1699306366,1699306819,1699307408,1699310221,1699310379,1699345529,1699358937,1699386605,1699391087,1699393144,1699477557,1699479307,1699482593,1699567886,1699569757,1699603218,1699633691,1699634927,1699650910,1702073325,1702075430,1702076069,1702104150,1702147082,1702150796,1702155925,1702157419,1702159518,1702243271,1702243945,1702245036,1702247069,1702283398,1702301278,1702308790,1702324859,1702330289,1702333976,1702370371,1702395788,1702398149,1702415404,1702416969,1702417565,1702420283,1702454176,1702500881,1702501540,1702504876,1702507332,1702542958,1702567554,1702586908,1702591418,1702593131]}

---------------------------------
6 /  / 2023-12-18T21:34:10.000
13 /  / len(colData)=201
{"Method":"finger","eventTimestamps":[1674598884,...
```

OK so it looks like only one of each event is stored. Looking at a specific book that I finished I get these events. I think this is 25, 50, 75% progress, 9 not sure, 1020/1021 start/stop final time (104 reading sessions?), 5/80 book finished. It looks like the ExtraData contains 104 timestamps so perhaps can recover/rebuild all the start/stops.

```
1012 / King, Stephen/Green Mile, The - Stephen King.kepub.epub /  / 2023-11-29T19:10:39.000 / 1 / map[GA4:map[book_id:file:///mnt/onboard/King, Stephen/Green Mile, The - Stephen King.kepub.epub progress:25] eventTimestamps:[1701285039]]
1013 / King, Stephen/Green Mile, The - Stephen King.kepub.epub /  / 2023-12-03T20:08:18.000 / 1 / map[GA4:map[book_id:file:///mnt/onboard/King, Stephen/Green Mile, The - Stephen King.kepub.epub progress:50] eventTimestamps:[1701634098]]
1014 / King, Stephen/Green Mile, The - Stephen King.kepub.epub /  / 2023-12-06T21:15:53.000 / 1 / map[GA4:map[book_id:file:///mnt/onboard/King, Stephen/Green Mile, The - Stephen King.kepub.epub progress:75] eventTimestamps:[1701897353]]
9 / King, Stephen/Green Mile, The - Stephen King.kepub.epub /  / 2023-12-08T17:00:17.000 / 8 / map[DictionaryName:-en GA4:map[locale:en_US] Word:Providence eventTimestamps:[1700808603 1701035371 1701552339 1701895713 1701900410 1701900415 1701967475 1702054817]]
1020 / King, Stephen/Green Mile, The - Stephen King.kepub.epub /  / 2023-12-08T21:46:41.000 / 104 / map[eventTimestamps:[1699390916 1699995922 1700775206 1700777020 1700808486 1700843368 1700844635 1700845334 1700861298 1700861845 1700864519 1700894867 1700922106 1700931561 1700936793 1700937956 1700945726 1700946971 1700947425 1700948574 1700979877 1700980260 1700987368 1700988396 1701013025 1701025690 1701034962 1701035914 1701037096 1701075512 1701104916 1701111405 1701120775 1701123044 1701162263 1701198432 1701198540 1701259766 1701284248 1701284268 1701284376 1701284682 1701295483 1701331940 1701371561 1701378438 1701382248 1701418086 1701458755 1701458766 1701461086 1701461537 1701467403 1701469746 1701500559 1701501024 1701503276 1701535302 1701535772 1701544037 1701544883 1701550072 1701553555 1701554839 1701593901 1701608041 1701620064 1701628283 1701628420 1701629054 1701630627 1701633991 1701634292 1701638329 1701640276 1701642116 1701675028 1701675338 1701709986 1701726309 1701728353 1701767289 1701803054 1701807591 1701813762 1701815308 1701895629 1701897917 1701900246 1701965715 1701965768 1701966084 1701977615 1701978289 1701985370 1702014718 1702016681 1702024027 1702048521 1702052625 1702054755 1702055246 1702069769 1702072001]]
1021 / King, Stephen/Green Mile, The - Stephen King.kepub.epub /  / 2023-12-08T22:06:44.000 / 104 / map[eventTimestamps:[1699390919 1699995928 1700775241 1700777637 1700808765 1700844558 1700844636 1700845338 1700861309 1700862290 1700865313 1700894951 1700922262 1700932069 1700937688 1700938439 1700946952 1700947180 1700947584 1700949595 1700980017 1700981503 1700988151 1700988577 1701013366 1701025774 1701035581 1701036102 1701037983 1701075754 1701105079 1701111411 1701121464 1701123941 1701162654 1701198472 1701198546 1701259767 1701284259 1701284295 1701284555 1701285129 1701297060 1701332302 1701371889 1701379564 1701382251 1701418373 1701458761 1701459380 1701461465 1701461538 1701467668 1701471147 1701500996 1701501271 1701503608 1701535769 1701535773 1701544271 1701545060 1701552549 1701553634 1701555845 1701594408 1701608284 1701620310 1701628289 1701628429 1701629855 1701630903 1701634285 1701636634 1701639089 1701640557 1701642922 1701675260 1701675482 1701710190 1701727015 1701729692 1701767422 1701803134 1701808312 1701814029 1701816947 1701897722 1701898957 1701901912 1701965718 1701965799 1701967565 1701977622 1701978720 1701986723 1702014722 1702017224 1702024444 1702049013 1702052628 1702055213 1702055630 1702069773 1702073204]]
5 / King, Stephen/Green Mile, The - Stephen King.kepub.epub /  / 2023-12-08T22:06:44.000 / 1 / map[IsMarkAsFinished:false eventTimestamps:[1702073204]]
80 / King, Stephen/Green Mile, The - Stephen King.kepub.epub /  / 2023-12-08T22:06:44.000 / 1 / map[eventTimestamps:[1702073204]]
```


## content table

content table looks promising for "ReadStatus" and Progress.

```sql
CREATE TABLE content(
    ContentID TEXT NOT NULL,
    ContentType TEXT NOT NULL, MimeType TEXT NOT NULL,
    BookID TEXT, BookTitle TEXT, ImageId TEXT, Title TEXT COLLATE NOCASE, Attribution TEXT COLLATE NOCASE, Description TEXT,
    DateCreated TEXT, ShortCoverKey TEXT, adobe_location TEXT, Publisher TEXT, IsEncrypted BOOL,
    DateLastRead TEXT, FirstTimeReading BOOL,
    ChapterIDBookmarked TEXT,ParagraphBookmarked INTEGER, BookmarkWordOffset INTEGER, NumShortcovers INTEGER, VolumeIndex INTEGER, ___NumPages INTEGER,
    ReadStatus INTEGER, ___SyncTime TEXT, ___UserID TEXT NOT NULL, PublicationId TEXT, ___FileOffset INTEGER, ___FileSize INTEGER,
    ___PercentRead INTEGER, ___ExpirationStatus INTEGER, FavouritesIndex NOT NULL DEFAULT -1, Accessibility INTEGER DEFAULT 1, ContentURL TEXT, Language TEXT,
    BookshelfTags TEXT, IsDownloaded BIT NOT NULL DEFAULT 1, FeedbackType INTEGER DEFAULT 0, AverageRating INTEGER DEFAULT 0, Depth INTEGER, PageProgressDirection TEXT,
    InWishlist BOOL NOT NULL DEFAULT FALSE, ISBN TEXT, WishlistedDate TEXT DEFAULT "0000-00-00T00:00:00.000", FeedbackTypeSynced INTEGER DEFAULT 0,
    IsSocialEnabled BOOL NOT NULL DEFAULT TRUE, EpubType INT NOT NULL DEFAULT -1, Monetization INTEGER DEFAULT 2, ExternalId TEXT, Series TEXT, SeriesNumber TEXT, Subtitle TEXT,
    WordCount INTEGER DEFAULT -1, Fallback TEXT, RestOfBookEstimate INTEGER, CurrentChapterEstimate INTEGER, CurrentChapterProgress FLOAT,
    PocketStatus INTEGER DEFAULT 0, UnsyncedPocketChanges TEXT, ImageUrl TEXT,
    DateAdded TEXT, WorkId TEXT, Properties TEXT, RenditionSpread TEXT, RatingCount INTEGER DEFAULT 0, ReviewsSyncDate TEXT,
    MediaOverlay TEXT, MediaOverlayType TEXT, RedirectPreviewUrl TEXT, PreviewFileSize INTEGER, EntitlementId TEXT, CrossRevisionId TEXT, DownloadUrl TEXT, ReadStateSynced BIT NOT NULL DEFAULT false,
    TimesStartedReading INTEGER, TimeSpentReading INTEGER,
    LastTimeStartedReading TEXT, LastTimeFinishedReading TEXT, ApplicableSubscriptions TEXT, ExternalIds TEXT, PurchaseRevisionId TEXT, SeriesID TEXT, SeriesNumberFloat REAL, AdobeLoanExpiration TEXT, HideFromHomePage bit, IsInternetArchive BOOL NOT NULL DEFAULT FALSE, titleKana TEXT, subtitleKana TEXT, seriesKana TEXT, attributionKana TEXT, publisherKana TEXT, IsPurchaseable BOOL DEFAULT TRUE, IsSupported BOOL DEFAULT TRUE, AnnotationsSyncToken TEXT, DateModified TEXT DEFAULT "0000-00-00T00:00:00.000", StorePages INTEGER DEFAULT 0, StoreWordCount INTEGER DEFAULT 0,
    StoreTimeToReadLowerEstimate INTEGER DEFAULT 0, StoreTimeToReadUpperEstimate INTEGER DEFAULT 0,
    Duration INTEGER DEFAULT 0, IsAbridged BOOL DEFAULT NULL, SyncConflictType INTEGER DEFAULT 0,
PRIMARY KEY (ContentID)		);
```

So finding finished books looks like ContentID = filename. BookID = empty. e.g. this covers the whole file. ReadStatus = 2 and PercentRead = 100 == Book Finished

```
---------------------------------
file:///mnt/onboard/Greer, John Michael/Twilight_s Last Gleaming - John Michael Greer.kepub.epub /  /
ReadStatus 2 / WordCount -1 / BookmarkWords 0
PercentRead 100
TimeStarted 0 / TimeSpent 0
LastTimeStartedReading  / LastTimeFinishedReading  / Duration 0
---------------------------------
file:///mnt/onboard/Al-Khalili, Jim/Sunfall_ The Cutting Edge _What-If_ Thriller From the Celebrated Scientist and BBC Broadcaster - Jim Al-Khalili.kepub.epub /  /
ReadStatus 2 / WordCount -1 / BookmarkWords 0
PercentRead 100
TimeStarted 0 / TimeSpent 0
LastTimeStartedReading  / LastTimeFinishedReading  / Duration 0
```

Finding word count. Looks like WordCount on each part is reliable. But the PercentRead, TimeStarted etc is not reliable. I have read and finished this book. (Will have to try to find the Event/Activity)

```
---------------------------------
/mnt/onboard/Greer, John Michael/Star_s Reach_ A Novel of the Deindustrial Future - John Michael Greer.kepub.epub!!text/part0000_split_004.html / file:///mnt/onboard/Greer, John Michael/Star_s Reach_ A Novel of the Deindustrial Future - John Michael Greer.kepub.epub / Star's Reach: A Novel of the Deindustrial Future
ReadStatus 0 / WordCount 4219 / BookmarkWords 0
PercentRead 4
TimeStarted 0 / TimeSpent 0
LastTimeStartedReading  / LastTimeFinishedReading  / Duration 0
---------------------------------
/mnt/onboard/Greer, John Michael/Star_s Reach_ A Novel of the Deindustrial Future - John Michael Greer.kepub.epub!!text/part0000_split_005.html / file:///mnt/onboard/Greer, John Michael/Star_s Reach_ A Novel of the Deindustrial Future - John Michael Greer.kepub.epub / Star's Reach: A Novel of the Deindustrial Future
ReadStatus 0 / WordCount 2936 / BookmarkWords 0
PercentRead 0
TimeStarted 0 / TimeSpent 0
LastTimeStartedReading  / LastTimeFinishedReading  / Duration 0
```

Finding total time spent reading. Not sure this will be reliable. Probably have to work it out by adding up Event/Activity instead. (TimeSpent is seconds?)

```
---------------------------------
file:///mnt/onboard/Cixin, Liu/Three-Body Problem, No. 2_ Dark Forest, The - Liu Cixin.kepub.epub /  /
ReadStatus 2 / WordCount -1 / BookmarkWords 0
PercentRead 100
TimeStarted 0 / TimeSpent 79514
LastTimeStartedReading  / LastTimeFinishedReading  / Duration 0
```


## Activity table

Activity table contains a BLOB but does not seem to have interesting data. RecentBook, TopPicks, WhatsNew etc

```
DEBUG! file:///mnt/onboard/Jackson, Shirley/Haunting of Hill House, The - Shirley Jackson.kepub.epub / false / RecentBook / 2 / 2023-11-07T21:01:51 / map[]
DEBUG! a6a8ec99-e9d9-4664-87d8-f2113c23f6e7 / false / RecentBook / 2 / 2023-11-23T21:33:17 / map[]
DEBUG! file:///mnt/onboard/Picknett, Lyrince, Clive/Stargate Conspiracy_ Revealing the Truth Behind Extraterrestrial Che Mysteries of Ancient Egypt - Lynn Picknett & Clive Prince.kepub.epub / false / RecentBook / 2 / 2023-11-23T22:03:38 / map[]
DEBUG! file:///mnt/onboard/King, Stephen/Green Mile, The - Stephen King.kepub.epub / false / RecentBook / 2 / 2023-12-08T22:06:43 / map[]
DEBUG! file:///mnt/onboard/King, Stephen/Different Seasons - Stephen King.kepub.epub / false / RecentBook / 2 / 2023-12-14T22:32:11 / map[]
DEBUG! b0d1b883-70ee-c833-4cb8-08d790600c26 / false / TopPicksTab / 1 / 2023-12-18T21:45:37 / map[ACTIVITY_TEXT:Coming soon to audiobooks BOOKSTORE_ACTIVITY_TAB_FILTER:{} BOOKSTORE_ACTIVITY_TAB_IS_LEAF:true BOOKSTORE_ACTIVITY_TAB_PARENT_ID:[97 98 99 100 101 102 102 102 45 102 102 102 102 45 102 102 102 102 45 102 102 102 102 45 102 102 102 102 102 102 102 102 101 102 101 51] BOOKSTORE_TAB_MAX_SIZE:300 BOOKSTORE_TAB_TYPE:[49] DISCOVERY_DESCRIPTION: DISCOVERY_VOLUME_ID_LIST:[2aadc0f9-0b07-4be6-8252-e8a8a35be26c 7bb33750-7043-4e3e-ac9c-003ab850a94f 83641dc3-01c6-437a-9784-411a9fa7bc3d 585f21e8-82bf-4ee4-ae78-770715d72e3a]]
DEBUG! SomeFakeRecommendedTabId / false / Recommendations / 1 / 2023-12-20T15:42:00 / map[DISCOVERY_DESCRIPTION:8 DISCOVERY_VOLUME_ID_LIST:[5c5385fd-6d61-4cb0-b55d-85bdca2c71ee 69bf947f-2429-4a03-9b04-695681ea4332 3cca3c69-bc3b-46a1-9bfd-f9d619ae5e93 6d02e85d-9c0c-43a1-b2bc-2a38e8711d6c d4edbe78-c3ea-48fa-ac68-1944904ed47c 002e5427-eff6-407c-9a5c-9ad0e0915cfe ae7352ca-5939-4041-ac70-bcc798e03af7 5c0b8dfc-9656-4b32-aec8-f3d7698afa8d 2adb7a72-5a65-4a24-b981-d230a8e1cd6b 6e085924-e598-4a26-abfb-ae11875e9a55 8193e3e3-b8eb-42c2-93b9-357aa0fd5112]]
DEBUG! file:///mnt/onboard/Ende, Michael/Neverending Story, The - Michael Ende.kepub.epub / false / RecentBook / 2 / 2023-12-22T19:48:56 / map[]

```

---

Notes on other tables while I'm here

## AnalyticsEvents table

Interesting data but is short. I guess this is wiped after sync. Seems to have a simple INSERT for everything like 'opened content', 'opened settings', 'book progress' (course 25, 50, 75, 100), etc.

## Shelf table

Shelf seems to contain position e.g. 'Reading' books. The last one you read jumps to the top.

## Activity table

Similar to shelf this seems to contain current state of open books etc.

## user table

Seems to contain a JWT I guess for talking to Kobo API. As well as email. client ID (maybe useful for removing DRM?) I also noticed client ID in other files in the .kobo directory
